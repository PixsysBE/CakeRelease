<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="EnsurePowerShellFiles" BeforeTargets="Build">

    <ItemGroup>
        <RewriteFiles Include="$(MSBuildThisFileDirectory)..\.build\CakeRelease\*.*" Exclude="$(MSBuildThisFileDirectory)..\.build\CakeRelease\Semantic\docs\*.*" />
        <NoOverwriteFiles Include= "$(MSBuildThisFileDirectory)..\.config\*.*" Exclude= "$(MSBuildThisFileDirectory)..\.config\dotnet-tools.json" />
    </ItemGroup>

    <!-- <Message Text="Source: @(RewriteFiles)" Importance="high" />
    <Message Text="Source: @(NoOverwriteFiles)" Importance="high" /> -->

  </Target>

  <Target Name="RunInstallPowerShellScript" BeforeTargets="Build">
    <PropertyGroup>
      <PSScriptPath>$(MSBuildThisFileDirectory)..\tools\config.ps1</PSScriptPath>
    </PropertyGroup>
    <Exec Command="powershell -ExecutionPolicy Bypass -File $(PSScriptPath) -MSBuildThisFileDirectory $(MSBuildThisFileDirectory) -MSBuildProjectDirectory $(MSBuildProjectDirectory) -MSBuildProjectName $(MSBuildProjectName) -MSBuildProjectFile $(MSBuildProjectFile)" />
  </Target>

  <Target Name="RunNpmPowerShellScript" BeforeTargets="Build">
    <PropertyGroup>
      <PSScriptPath>$(MSBuildThisFileDirectory)..\tools\npm.ps1</PSScriptPath>
    </PropertyGroup>
    <Exec Command="powershell -ExecutionPolicy Bypass -File $(PSScriptPath) -projectDirectory $(MSBuildProjectDirectory)" />
  </Target>

  <Target Name="CopyNuspec" BeforeTargets="Build">
    <PropertyGroup>
      <NuspecSource>$(MSBuildThisFileDirectory)..\.config\.nuspec.sample</NuspecSource>
      <NuspecTarget>$(MSBuildProjectDirectory)\..\.config\.nuspec</NuspecTarget>
    </PropertyGroup>

    <!-- <Message Text="Nuspec Source: $(NuspecSource)" Importance="high" />
    <Message Text="Nuspec Destination: $(NuspecTarget)" Importance="high" /> -->

    <Copy
    SourceFiles="$(NuspecSource)"
    DestinationFiles="$(NuspecTarget)"
    SkipUnchangedFiles="true"
    OverwriteReadOnlyFiles="false"   
    Condition="!Exists($(NuspecTarget))"
    />
  </Target>

  <Target Name="CopyLauncher" BeforeTargets="Build">
    <PropertyGroup>
      <LauncherSource>$(MSBuildThisFileDirectory)..\tools\launcher.ps1</LauncherSource>
      <LauncherTarget>$(MSBuildProjectDirectory)\..\.build\CakeRelease\cakerelease.ps1</LauncherTarget>
    </PropertyGroup>

    <!-- <Message Text="Launcher Source: $(LauncherSource)" Importance="high" />
    <Message Text="Launcher Destination: $(LauncherTarget)" Importance="high" /> -->

    <Copy
    SourceFiles="$(LauncherSource)"
    DestinationFiles="$(LauncherTarget)"
    SkipUnchangedFiles="false"
    OverwriteReadOnlyFiles="true"   
    />
  </Target>
</Project>
